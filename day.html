<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WSP ‚Äî Daytime</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="day">
  <header class="bar">
    <a href="index.html" class="back">‚Üê Back</a>
    <h2>Daytime ‚Äî lively, bright, tourist energy</h2>
  </header>

  <div id="scene"></div>

  <!-- Simple audio controls -->
  <div class="audio-ui glass">
    <button id="playBtn">Play</button>
    <input id="vol" type="range" min="0" max="1" step="0.01" value="0.5"/>
    <span class="hint">Click Play once (browser gesture) ‚Üí sound loops.</span>
  </div>

  <!-- p5 + p5.sound -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/addons/p5.sound.min.js"></script>
  <script>
    let ripples = [];
    let photoIcons = [];
    let saxPulse = 0;
    let daySound;
    let isPlaying = false;

    function preload() {
      // Load your ambience
      daySound = loadSound('assets/day_ambience.mp3');
    }

    function setup() {
      const c = createCanvas(windowWidth, windowHeight - 64);
      c.parent('scene');
      colorMode(HSL, 360, 100, 100, 1);

      // Fountain ripple seeds
      for (let i = 0; i < 3; i++) {
        ripples.push({r: 40 + i*30, speed: 0.6 + i*0.15, alpha: 0.35});
      }
      // Floating ‚Äútourist‚Äù emojis
      const emotes = ['üì∏','üéí','üé≠','üé®'];
      for (let i = 0; i < emotes.length; i++) {
        photoIcons.push({
          t: random(TWO_PI),
          x: map(i,0,emotes.length-1,width*0.2,width*0.8),
          yBase: random(height*0.5, height*0.8),
          emoji: emotes[i],
          spd: random(0.6,1.1)
        });
      }

      // Audio UI
      select('#playBtn').mousePressed(() => {
        if (!isPlaying) {
          daySound.loop();
          daySound.setVolume(select('#vol').elt.value);
          isPlaying = true;
          select('#playBtn').html('Pause');
        } else {
          daySound.pause();
          isPlaying = false;
          select('#playBtn').html('Play');
        }
      });
      select('#vol').input(() => {
        if (daySound && daySound.isLoaded()) daySound.setVolume(select('#vol').elt.value);
      });
    }

    function draw() {
      // sky
      setGradient(color(210,100,99), color(210,60,92));
      drawArch(false);

      // Fountain basin (center)
      push();
      translate(width*0.5, height*0.55);
      noFill(); stroke(220,10,25, 0.3); ellipse(0,0, 260,260);

      // Ripples
      for (let r of ripples) {
        stroke(210,40,25, r.alpha);
        ellipse(0,0, r.r*2, r.r*2);
        r.r += r.speed;
        if (r.r > 180) { r.r = 40; }
      }
      pop();

      // Performer pulse (right side)
      saxPulse = (saxPulse + 0.02) % TWO_PI;
      const pulse = map(sin(saxPulse), -1, 1, 0.8, 1.3);
      push();
      translate(width*0.68, height*0.62);
      noFill(); stroke(35,100,60, .45);
      ellipse(0,0, 120*pulse, 120*pulse);
      noStroke(); textAlign(CENTER,CENTER); textSize(28);
      text('üé∑',0,0-2);
      pop();

      // Floating emojis (gentle bob)
      noStroke(); textAlign(CENTER, CENTER); textSize(28);
      for (let p of photoIcons) {
        p.t += 0.01 * p.spd;
        const y = p.yBase + sin(p.t) * 12;
        text(p.emoji, p.x, y);
      }

      // Caption card
      drawCard(16,16, "Afternoon vibe:\nPerformers, photos by the arch,\ncrowds near the fountain.");
    }

    function setGradient(c1, c2) {
      for (let y=0; y<height; y++) {
        const inter = y/height;
        stroke( lerpColor(c1,c2,inter) );
        line(0,y,width,y);
      }
    }

    function drawArch(light) {
      // simple arch: top + two pillars
      push();
      fill(light? 0:0); // handled by overlay
      noStroke();
      const archY = height*0.21;
      const archX = width*0.5;
      const topW = 180, topH = 40, pW = 20, pH = 100;
      // top (dark on day)
      fill(0,0,10);
      rectMode(CENTER); rect(archX, archY, topW, topH, 8);
      // pillars
      rect(archX - topW/2 + 14, archY + pH/2, pW, pH, 6);
      rect(archX + topW/2 - 14, archY + pH/2, pW, pH, 6);
      pop();
    }

    function drawCard(x,y,msg){
      push();
      rectMode(CORNER);
      noStroke();
      fill(0,0,100, .85);
      rect(x,y, 300, 80, 12);
      fill(0,0,10);
      textAlign(LEFT,TOP); textSize(14);
      text(msg, x+12, y+10);
      pop();
    }

    function windowResized(){ resizeCanvas(windowWidth, windowHeight - 64); }
  </script>
</body>
</html>
